name: ðŸ§¹ Lint & Static Analysis

on:
  push:
    branches: [ master, develop ]
  pull_request:

jobs:
  lint:
    runs-on: ubuntu-latest
    name: Lint & Analyse PHP

    steps:
      - name: ðŸ§¾ Checkout
        uses: actions/checkout@v4

      - name: âš™ï¸ Setup PHP
        uses: shivammathur/setup-php@v2
        with:
          php-version: '8.3'
          tools: phpstan, rector, php-cs-fixer
          extensions: mbstring, intl, pdo, dom, curl, zip

      - name: ðŸ§© Validate composer.json
        run: |
          composer validate --strict
          echo "âœ… composer.json validation passed" >> $GITHUB_STEP_SUMMARY

      - name: ðŸ” Run PHPStan
        run: |
          if [ -f vendor/bin/phpstan ]; then
            vendor/bin/phpstan analyse src --level=8 --memory-limit=1G --ansi
            echo "âœ… PHPStan passed" >> $GITHUB_STEP_SUMMARY
          else
            echo "âš ï¸ phpstan not found â€” skipping" >> $GITHUB_STEP_SUMMARY
          fi

      - name: ðŸ§  Run Rector (dry-run)
        run: |
          if [ -f vendor/bin/rector ]; then
            vendor/bin/rector process src --dry-run --no-progress-bar --ansi
            echo "âœ… Rector dry-run passed" >> $GITHUB_STEP_SUMMARY
          else
            echo "âš ï¸ Rector not installed â€” skipping" >> $GITHUB_STEP_SUMMARY
          fi

      - name: ðŸŽ¨ Check code style
        run: |
          if [ -f vendor/bin/php-cs-fixer ]; then
            vendor/bin/php-cs-fixer fix --dry-run --diff --ansi
            echo "âœ… Code style OK" >> $GITHUB_STEP_SUMMARY
          else
            echo "âš ï¸ php-cs-fixer not installed â€” skipping" >> $GITHUB_STEP_SUMMARY
          fi
